<div class="px-2 pb-2">
  <div class="d-flex align-items-center justify-content-between">
    <img src="/img/Whatsupp.png" alt="Whatsupp" class="img-fluid mb-1" width="20%">
    <div class="dropdown">
      <button class=" border-0 bg-transparent" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="ri-edit-box-line fs-4 text-white"></i>
        <% if(friendRequests.length > 0) {%>
        <i class="alertBox"><%= friendRequests.length %></i>
        <%}%>
      </button>
      <ul class="dropdown-menu" style="width: 300px; min-width: fit-content;">
        <li>
          <h4 class="dropdown-item">
            <%= currentUser.username %>
          </h4>
        </li>
        <li>
          <a href="/users/profile" class="dropdown-item">View profile</a>
        </li>
        <!-- Pending Friend Requests -->
        <% if(friendRequests.length> 0) {%>
          <li>
            <h2 class="mb-2 lead dropdown-item fw-bold">Pending Requests</h2>
            <ul class="list-group" id="friend-requests">
              <% friendRequests.forEach(request=> { %>
                <li style="cursor: default;" class="dropdown-item d-flex align-items-center justify-content-between gap-2 ">
                  <h4 class="lead fw-bold">
                      <%= request.sender_username %>
                  </h4>
                  <div class="d-flex gap-2 align-items-center">
                    <form action="/friends/accept-request" method="POST" class="m-0 p-0">
                      <input type="hidden" name="requestId" value="<%= request.id %>">
                      <input type="hidden" name="token" value="<%= token %>">
                      <button type="submit" class="btn btn-sm btn-success">Accept</button>
                    </form>
                    <form action="/friends/reject-request" method="POST" class="m-0 p-0">
                      <input type="hidden" name="requestId" value="<%= request.id %>">
                      <input type="hidden" name="token" value="<%= token %>">
                      <button type="submit" class="btn btn-sm btn-danger">Reject</button>
                    </form>
                  </div>
                </li>
                <% }) %>
            </ul>
          </li>
          <% } %>
      </ul>
    </div>
  </div>

  <!-- Search Bar -->
  <form action="/users/search" method="GET" class="mb-3 d-flex align-items-center gap-2">
    <input type="text" name="username" placeholder="Search by username" class="form-control" required>
    <button type="submit" class="btn btn btn-success">Search</button>
  </form>
  <hr class="mb-3">
  <h2 class="mb-2 lead fs-5 fw-bold">Chats</h2>
  <ul class="list-group" id="user-list">
    <% friends.forEach(friend=> { %>
      <a href="/messages/chat?receiverId=<%= friend.id %>"
        class="rounded list-group-item-success list-group-item-action text-start text-decoration-none lead p-2 mb-1">
        <li class="p-0 d-flex align-items-center gap-2">
          <div class="rounded-circle overflow-hidden" style="width: 60px; height: 60px;">
            <img src="/<%= friend.avatar_url %>" class="img-fluid rounded-circle" alt="<%= friend.username %>'s avatar" width="60px" height="60px">
          </div>
          <strong style="width:150px;overflow: hidden; white-space: nowrap; text-overflow: ellipsis; text-align: start;" ><%= friend.username %></strong>
        </li>
      </a>
      <% }) %>
  </ul>
</div>